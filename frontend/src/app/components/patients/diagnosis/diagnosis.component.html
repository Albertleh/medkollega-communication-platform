<div class="bg-white p-4 rounded-2xl shadow-md h-full flex flex-col">

  <!-- HEADER -->
  <div class="mb-3 flex-shrink-0">
    <h2 class="text-xl font-semibold">Diagnosen</h2>
  </div>

  <!-- SCROLLBEREICH -->
  <div class="flex-1 overflow-y-auto pr-1 [box-shadow:inset_0_-6px_6px_-6px_rgba(0,0,0,0.12)]">

    <h3 class="text-sm font-semibold mb-2">Aktuelle Diagnosen</h3>

    <div *ngIf="!loading && diagnoses.length === 0"
         class="text-gray-500 text-sm mb-4">
      Keine aktuellen Diagnosen.
    </div>

    <div *ngFor="let d of filteredDiagnoses" class="p-4 border rounded-lg bg-gray-50 mb-3">


      <div class="pr-4 flex-1">
        <p class="font-semibold break-words">{{ d.diagnosisText }}</p>

        <div class="flex justify-between text-sm text-gray-600 mt-1">
          <span>ICD: {{ d.icdCode }}</span>

          <span *ngIf="d.validUntil"
                class="text-xs text-gray-500 whitespace-nowrap ml-4">
            Gültig bis: {{ d.validUntil | date:'dd.MM.yyyy' }}
          </span>
        </div>
      </div>

      <div class="flex flex-col items-end text-xs space-y-1">
        <button class="text-blue-600 hover:underline"
                (click)="moveToPast(d.id)">
          Zu Vergangenheit
        </button>

        <button class="text-red-600 hover:underline"
                (click)="delete(d.id)">
          Löschen
        </button>
      </div>
    </div>

    <h3 class="text-sm font-semibold mt-6 mb-2">Vergangene Diagnosen</h3>

    <div *ngIf="pastDiagnoses.length === 0"
         class="text-gray-500 text-sm mb-4">
      Keine vergangenen Diagnosen.
    </div>

    <div *ngFor="let d of filteredPastDiagnoses" class="p-4 border rounded-lg bg-gray-50 mb-3">


      <p class="font-semibold">{{ d.diagnosisText }}</p>

      <div class="flex justify-between items-end text-sm text-gray-600 mt-1">
        <span>ICD: {{ d.icdCode }}</span>
        <span class="text-xs">
          Gültig gewesen bis: {{ d.validUntil | date:'dd.MM.yyyy' }}
        </span>

        <button class="text-red-600 hover:underline text-xs mt-2"
                (click)="delete(d.id)">
          Löschen
        </button>
      </div>

      
    </div>

  </div>

  <!-- FIXE EINGABE UNTEN -->
  <div class="pt-3 border-t mt-auto flex-shrink-0 bg-white">

    <label class="block text-md font-bold text-gray-700 mb-2">
      Neue Diagnose
    </label>

    <div class="flex items-end gap-3 mb-2">
      <input [(ngModel)]="newDiagnosisText"
             type="text"
             placeholder="Diagnosetext"
             class="flex-1 border rounded-lg p-2.5 text-sm"/>

      <input [(ngModel)]="newDiagnosisIcd"
             type="text"
             placeholder="ICD"
             class="w-24 border rounded-lg p-2.5 text-sm"/>
    </div>

    <div class="flex items-end gap-3">
      <input [(ngModel)]="newDiagnosisValidUntil"
             type="date"
             class="flex-1 border rounded-lg p-2.5 text-sm"/>

      <button
        (click)="create()"
        class="h-[42px] px-5 rounded-lg text-sm font-medium text-white
               bg-[#2D6A6A] hover:bg-[#245757] transition shrink-0">
        Speichern
      </button>
    </div>

  </div>
</div>
